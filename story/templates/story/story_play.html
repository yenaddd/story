<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DeepSeek Story Game</title>
    <style>
        body { font-family: 'Inter', sans-serif; max-width: 800px; margin: 0 auto; padding: 40px; background: #f8fafc; color: #334155; }
        .story-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); white-space: pre-wrap; line-height: 1.8; font-size: 1.1em; }
        .btn-choice { display: block; width: 100%; padding: 15px; margin-top: 15px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; text-align: left; font-size: 1em; transition: 0.2s; }
        .btn-choice:hover { background: #4338ca; }
        .btn-twist { background: #dc2626; } /* ë°˜ì „ ì„ íƒì§€ ê°•ì¡° */
        .btn-twist:hover { background: #b91c1c; }
    </style>
</head>
<body>
    <h1>ğŸ“– ì¸í„°ë™í‹°ë¸Œ ìŠ¤í† ë¦¬</h1>
    <div id="story-content" class="story-box">ë¡œë”© ì¤‘...</div>
    <div id="choices-area"></div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        let currentNodeId = urlParams.get('node_id') || 1;
        let prevChoiceId = null; // ì‚¬ìš©ìê°€ ì§ì „ì— ëˆ„ë¥¸ ì„ íƒì§€ ID

        async function loadNode(nodeId, choiceId = null) {
            const contentDiv = document.getElementById('story-content');
            const choicesDiv = document.getElementById('choices-area');
            
            contentDiv.textContent = "ì´ì•¼ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";
            choicesDiv.innerHTML = "";

            // API í˜¸ì¶œ ì‹œ ì´ì „ ì„ íƒì§€ IDë¥¼ í•¨ê»˜ ì „ì†¡
            let url = `/story/api/node/${nodeId}/`;
            if (choiceId) {
                url += `?prev_choice=${choiceId}`;
            }

            try {
                const res = await fetch(url);
                if(!res.ok) throw new Error("ë¡œë“œ ì‹¤íŒ¨");
                const data = await res.json();

                // ë‚´ìš© í‘œì‹œ (ì„œë²„ì—ì„œ ì´ë¯¸ result_textë¥¼ í•©ì³ì„œ ë³´ëƒ„)
                contentDiv.textContent = data.story_text;

                // ì„ íƒì§€ í‘œì‹œ
                if (data.choices.length === 0) {
                    choicesDiv.innerHTML = "<p style='text-align:center; font-weight:bold;'>THE END</p>";
                } else {
                    data.choices.forEach(c => {
                        const btn = document.createElement('button');
                        btn.className = c.is_twist ? 'btn-choice btn-twist' : 'btn-choice';
                        btn.textContent = `ğŸ‘‰ ${c.text}`;
                        btn.onclick = () => loadNode(c.next_node_id, c.id);
                        choicesDiv.appendChild(btn);
                    });
                }
            } catch (e) {
                contentDiv.textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.message;
            }
        }

        loadNode(currentNodeId);
    </script>
</body>
</html>